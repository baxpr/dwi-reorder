Bootstrap: docker
From: ubuntu:bionic-20191029

%help


%files
  src    /opt

 
%labels
  Maintainer baxter.rogers@vanderbilt.edu


%post
  apt-get update

  # Workaround for filename case collision in linux-libc-dev
  # https://stackoverflow.com/questions/15599592/compiling-linux-kernel-error-xt-connmark-h
  # https://superuser.com/questions/1238903/cant-install-linux-libc-dev-in-ubuntu-on-windows
  apt-get install -y binutils xz-utils 
  mkdir pkgtemp && cd pkgtemp
  apt-get download linux-libc-dev
  ar x linux-libc-dev*deb
  tar xJf data.tar.xz
  tar cJf data.tar.xz ./usr
  ar rcs linux-libc-dev*.deb debian-binary control.tar.xz data.tar.xz
  dpkg -i linux-libc-dev*.deb
  cd .. && rm -r pkgtemp

  apt-get install -y wget                      # So useful
  apt-get install -y xvfb                      # for headless X11
  apt-get install -y python3-pip               # Also so useful
  apt-get install -y ghostscript imagemagick   # for PDF generation

  # Python libraries for assessor code
  pip3 install --upgrade pip3
  pip3 install nibabel pandas

  # FSL info:
  #   Mirrors:  https://fsl.fmrib.ox.ac.uk/fsldownloads/fslmirrorlist.txt
  #                 (the only mirror is https://fsl.fmrib.ox.ac.uk/fsldownloads/)
  #   Manifest: https://fsl.fmrib.ox.ac.uk/fsldownloads/manifest.json
  #             https://fsl.fmrib.ox.ac.uk/fsldownloads/manifest.json


  # Possible FSL install, h/t https://github.com/MPIB/singularity-fsl
#  apt-get -y install wget python-minimal libgomp1 ca-certificates \
#          libglu1-mesa libgl1-mesa-glx libsm6 libice6 libxt6 \
#          libjpeg62-turbo libpng16-16 libxrender1 libxcursor1 \
#          libxinerama1 libfreetype6 libxft2 libxrandr2 libmng1 \
#          libgtk2.0-0 libpulse0 libasound2 libcaca0 libopenblas-base \
#          bzip2 dc bc
#  wget https://fsl.fmrib.ox.ac.uk/fsldownloads/fslinstaller.py
#  python2 fslinstaller.py -d /usr/local/fsl -V 6.0.2
#  echo '/usr/local/fsl/lib' > /etc/ld.so.conf.d/fsl.conf
#  ldconfig
#  apt-get clean && apt-get -y autoremove



%environment

  # FSL
#  export FSLDIR=/usr/local/fsl
#  . ${FSLDIR}/etc/fslconf/fsl.sh
#  export PATH=${FSLDIR}/bin:${PATH}
	
  # Spider-specific code
  export PATH="/opt/src:${PATH}"


%runscript
  xvfb_wrapper.sh "$@"
